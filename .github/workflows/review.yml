name: GeminiSharp PR Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'

      - name: Run Falcon Linter PR Review
        env:
          GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          PR_STYLE_GUIDE: |
            Follow C# SDK best practices for the GeminiSharp library, ensuring compatibility with the Gemini API.
            Adhere to SOLID principles strictly, emphasizing single responsibility and interface segregation for API client classes.
            Use clear, descriptive naming conventions following C# standards (e.g., PascalCase for public members, camelCase for parameters).
            Favor immutability in API models and DTOs to ensure thread-safety and predictability.
            Ensure all public methods and classes are well-documented with XML comments for IntelliSense support.
            Avoid side effects in API calls; ensure methods are stateless or explicitly document state changes.
            Implement robust exception handling, propagating Gemini API errors with meaningful messages.
            Minimize code duplication by leveraging helper methods and shared utilities in the GeminiSharp namespace.
            Ensure thread-safety for HTTP client interactions and proper disposal of resources (e.g., HttpClient).
            Follow REST client best practices, including proper HTTP status code handling and retry logic where applicable.
            Write unit tests for all public API methods, covering edge cases and error conditions.
            Optimize performance for API calls without compromising code clarity or maintainability.
            Ensure compatibility with .NET 6.0 or later for broad usability.
            Validate that all public APIs are intuitive and align with the Gemini API's expected usage patterns.
        run: |
          npx falcon-linter \
            --provider github \
            --pr-id ${{ github.event.pull_request.number }} \
            --owner ${{ github.repository_owner }} \
            --repo ${{ github.event.repository.name }} \
            --style-guide "$PR_STYLE_GUIDE"